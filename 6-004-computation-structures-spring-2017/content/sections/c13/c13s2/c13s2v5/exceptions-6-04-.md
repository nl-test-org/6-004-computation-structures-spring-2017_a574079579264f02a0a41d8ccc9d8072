---
about_this_resource_text: ''
course_id: 6-004-computation-structures-spring-2017
embedded_media:
- id: Video-YouTube-Stream
  media_location: QBcQJdJk9r8
  parent_uid: 44cf90e6488547f11e513f0eeffbd665
  title: Video-YouTube-Stream
  type: Video
  uid: 6c13848cedee1e6cb25e8cdc6ac4964d
- id: 3Play-3Play YouTube id-Stream
  media_location: QBcQJdJk9r8
  parent_uid: 44cf90e6488547f11e513f0eeffbd665
  title: 3Play-3Play YouTube id
  type: 3Play
  uid: 4d9856052e80f4f50d51d34059d36597
- id: Thumbnail-YouTube-JPG_1
  media_location: https://img.youtube.com/vi/QBcQJdJk9r8/default.jpg
  parent_uid: 44cf90e6488547f11e513f0eeffbd665
  title: Thumbnail-YouTube-JPG
  type: Thumbnail
  uid: 0f3c4b5e82bec474aab33c2b801557d4
- id: QBcQJdJk9r8.srt
  parent_uid: 44cf90e6488547f11e513f0eeffbd665
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-004-computation-structures-spring-2017/c13/c13s2/c13s2v5/exceptions-6-04-/QBcQJdJk9r8.srt
  title: 3play caption file
  type: null
  uid: 57203d5f47aa99ab0759afa4132d2c5f
- id: QBcQJdJk9r8.pdf
  parent_uid: 44cf90e6488547f11e513f0eeffbd665
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-004-computation-structures-spring-2017/c13/c13s2/c13s2v5/exceptions-6-04-/QBcQJdJk9r8.pdf
  title: 3play pdf file
  type: null
  uid: e5dc7ee8a49e13d41cd9b5f3c89c7c23
- id: Caption-3Play YouTube id-SRT
  parent_uid: 44cf90e6488547f11e513f0eeffbd665
  title: Caption-3Play YouTube id-SRT-English - US
  type: Caption
  uid: 4f7775748fe53ab6ec893d2f6728eb1f
- id: Transcript-3Play YouTube id-PDF
  parent_uid: 44cf90e6488547f11e513f0eeffbd665
  title: Transcript-3Play YouTube id-PDF-English - US
  type: Transcript
  uid: dbb2d7ca10dca83ea621a793e1c4d46b
- id: Video-InternetArchive-MP4
  media_location: https://archive.org/download/MIT6.004S17/MIT6_004S17_13-02-05_300k.mp4
  parent_uid: 44cf90e6488547f11e513f0eeffbd665
  title: Video-Internet Archive-MP4
  type: Video
  uid: 5bd9860c4b9a522912ce295b0234139d
inline_embed_id: 5959916exceptions60484600650
layout: video
order_index: null
parent_uid: 3339e7b2dedbddbe9b93a8175284f567
related_resources_text: ''
short_url: exceptions-6-04-
technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-004-computation-structures-spring-2017/c13/c13s2/c13s2v5/exceptions-6-04-
template_type: Embed
title: Exceptions (6:04)
transcript: "<p><span m='340'>One</span> <span m='890'>last</span> <span m='1190'>bit</span>\
  \ <span m='1330'>of</span> <span m='1440'>housekeeping,</span> <span m='2200'>then</span>\
  \ <span m='2510'>we\u2019re</span> <span m='2670'>done!</span> </p><p><span m='3950'>What</span>\
  \ <span m='4170'>should</span> <span m='4330'>our</span> <span m='4470'>hardware</span>\
  \ <span m='5040'>do</span> <span m='5450'>if</span> <span m='5650'>for</span> <span\
  \ m='5820'>some</span> <span m='6120'>reason</span> <span m='6540'>an</span> <span\
  \ m='6680'>instruction</span> <span m='7310'>can\u2019t</span> <span m='7690'>be</span>\
  \ <span m='7850'>executed?</span> </p><p><span m='9050'>For</span> <span m='9240'>example,</span>\
  \ <span m='9930'>if</span> <span m='10290'>a</span> <span m='10340'>programming</span>\
  \ <span m='11050'>error</span> <span m='11320'>has</span> <span m='11590'>led</span>\
  \ <span m='11830'>to</span> <span m='11930'>trying</span> <span m='12250'>to</span>\
  \ <span m='12380'>execute</span> <span m='12880'>some</span> <span m='13070'>piece</span>\
  \ <span m='13330'>of</span> <span m='13460'>data</span> <span m='13870'>as</span>\
  \ <span m='14060'>an</span> <span m='14130'>instruction</span> <span m='15060'>and</span>\
  \ <span m='15430'>the</span> <span m='15540'>opcode</span> <span m='16040'>field</span>\
  \ <span m='16340'>doesn\u2019t</span> <span m='16640'>correspond</span> <span m='17270'>to</span>\
  \ <span m='17380'>a</span> <span m='17420'>Beta</span> <span m='17770'>instruction</span>\
  \ <span m='18550'>(a</span> <span m='18790'>so-called</span> <span m='19480'>\u201C\
  illop\u201D</span> <span m='20050'>or</span> <span m='20280'>illegal</span> <span\
  \ m='20770'>operation).</span> </p><p><span m='22620'>Or</span> <span m='22750'>maybe</span>\
  \ <span m='23090'>the</span> <span m='23180'>memory</span> <span m='23330'>address</span>\
  \ <span m='23810'>is</span> <span m='23940'>larger</span> <span m='24410'>than</span>\
  \ <span m='24600'>the</span> <span m='24750'>actual</span> <span m='25230'>amount</span>\
  \ <span m='25610'>main</span> <span m='25900'>memory.</span> </p><p><span m='27260'>Or</span>\
  \ <span m='27400'>maybe</span> <span m='27720'>one</span> <span m='27930'>of</span>\
  \ <span m='27990'>the</span> <span m='28100'>operand</span> <span m='28640'>values</span>\
  \ <span m='29120'>is</span> <span m='29220'>not</span> <span m='29430'>acceptable,</span>\
  \ <span m='30410'>e.g.,</span> <span m='31340'>if</span> <span m='31840'>the</span>\
  \ <span m='31960'>B</span> <span m='32259'>operand</span> <span m='32880'>for</span>\
  \ <span m='33100'>a</span> <span m='33130'>DIV</span> <span m='33420'>instruction</span>\
  \ <span m='34250'>is</span> <span m='34730'>0.</span> </p><p><span m='36910'>In</span>\
  \ <span m='37050'>modern</span> <span m='37390'>computers,</span> <span m='37930'>the</span>\
  \ <span m='38060'>accepted</span> <span m='38530'>strategy</span> <span m='39210'>is</span>\
  \ <span m='39380'>cease</span> <span m='39940'>execution</span> <span m='40590'>of</span>\
  \ <span m='40680'>the</span> <span m='40770'>running</span> <span m='41100'>program</span>\
  \ <span m='41840'>and</span> <span m='42160'>transfer</span> <span m='42740'>control</span>\
  \ <span m='43280'>to</span> <span m='43400'>some</span> <span m='43710'>error</span>\
  \ <span m='44050'>handler</span> <span m='44450'>code.</span> </p><p><span m='45720'>The</span>\
  \ <span m='45950'>error</span> <span m='46160'>handler</span> <span m='46610'>might</span>\
  \ <span m='46860'>store</span> <span m='47240'>the</span> <span m='47320'>program</span>\
  \ <span m='47810'>state</span> <span m='48130'>onto</span> <span m='48390'>disk</span>\
  \ <span m='48750'>for</span> <span m='48880'>later</span> <span m='49130'>debugging.</span>\
  \ </p><p><span m='50520'>Or,</span> <span m='51080'>for</span> <span m='51430'>an</span>\
  \ <span m='51520'>unimplemented</span> <span m='52330'>but</span> <span m='52500'>legal</span>\
  \ <span m='52850'>opcode,</span> <span m='53680'>it</span> <span m='54020'>might</span>\
  \ <span m='54340'>emulate</span> <span m='54860'>the</span> <span m='54950'>missing</span>\
  \ <span m='55320'>instruction</span> <span m='55860'>in</span> <span m='55920'>software</span>\
  \ <span m='56900'>and</span> <span m='57200'>resume</span> <span m='57680'>execution</span>\
  \ <span m='58410'>as</span> <span m='58570'>if</span> <span m='58730'>the</span>\
  \ <span m='58870'>instruction</span> <span m='59450'>had</span> <span m='59580'>been</span>\
  \ <span m='59740'>implemented</span> <span m='60300'>in</span> <span m='60420'>hardware!</span>\
  \ </p><p><span m='62860'>There\u2019s</span> <span m='63080'>also</span> <span m='63510'>the</span>\
  \ <span m='63640'>need</span> <span m='63920'>to</span> <span m='64030'>deal</span>\
  \ <span m='64239'>with</span> <span m='64440'>external</span> <span m='65150'>events,</span>\
  \ <span m='65750'>like</span> <span m='66070'>those</span> <span m='66400'>associated</span>\
  \ <span m='66960'>with</span> <span m='67100'>input</span> <span m='67450'>and</span>\
  \ <span m='67590'>output.</span> </p><p><span m='69050'>Here</span> <span m='69190'>we\u2019\
  d</span> <span m='69450'>like</span> <span m='69700'>to</span> <span m='69830'>interrupt</span>\
  \ <span m='70280'>the</span> <span m='70420'>execution</span> <span m='71010'>of</span>\
  \ <span m='71100'>the</span> <span m='71180'>current</span> <span m='71540'>program,</span>\
  \ <span m='72390'>run</span> <span m='72880'>some</span> <span m='73110'>code</span>\
  \ <span m='73450'>to</span> <span m='73520'>deal</span> <span m='73870'>with</span>\
  \ <span m='74000'>the</span> <span m='74130'>external</span> <span m='74630'>event,</span>\
  \ <span m='75200'>then</span> <span m='75600'>resume</span> <span m='76140'>execution</span>\
  \ <span m='76880'>as</span> <span m='77120'>if</span> <span m='77330'>the</span>\
  \ <span m='77500'>interrupt</span> <span m='77930'>had</span> <span m='78140'>never</span>\
  \ <span m='78440'>happened.</span> </p><p><span m='80300'>To</span> <span m='80390'>deal</span>\
  \ <span m='80650'>with</span> <span m='80800'>these</span> <span m='81030'>cases,</span>\
  \ <span m='81540'>we\u2019ll</span> <span m='81790'>add</span> <span m='81960'>hardware</span>\
  \ <span m='82570'>to</span> <span m='82690'>treat</span> <span m='82950'>exceptions</span>\
  \ <span m='83530'>like</span> <span m='83830'>forced</span> <span m='84250'>procedure</span>\
  \ <span m='84730'>calls</span> <span m='85170'>to</span> <span m='85300'>special</span>\
  \ <span m='85720'>code</span> <span m='86110'>to</span> <span m='86220'>handle</span>\
  \ <span m='86600'>the</span> <span m='86680'>situation,</span> </p><p><span m='88210'>arranging</span>\
  \ <span m='88580'>to</span> <span m='88690'>save</span> <span m='89110'>the</span>\
  \ <span m='89200'>PC+4</span> <span m='89970'>value</span> <span m='90670'>of</span>\
  \ <span m='90760'>the</span> <span m='90890'>interrupted</span> <span m='91410'>program</span>\
  \ <span m='92220'>so</span> <span m='92570'>that</span> <span m='92710'>the</span>\
  \ <span m='92820'>handler</span> <span m='93240'>can</span> <span m='93660'>resume</span>\
  \ <span m='94300'>execution</span> <span m='95050'>if</span> <span m='95180'>it</span>\
  \ <span m='95250'>wishes.</span> </p><p><span m='96710'>This</span> <span m='97080'>is</span>\
  \ <span m='97280'>a</span> <span m='97340'>very</span> <span m='97650'>powerful</span>\
  \ <span m='98210'>feature</span> <span m='98590'>since</span> <span m='98850'>it</span>\
  \ <span m='98910'>allows</span> <span m='99370'>us</span> <span m='99580'>to</span>\
  \ <span m='99670'>transfer</span> <span m='100190'>control</span> <span m='100670'>to</span>\
  \ <span m='100760'>software</span> <span m='101350'>to</span> <span m='101500'>handle</span>\
  \ <span m='102110'>most</span> <span m='102660'>any</span> <span m='102890'>circumstance</span>\
  \ <span m='103740'>beyond</span> <span m='104110'>the</span> <span m='104170'>capability</span>\
  \ <span m='104900'>of</span> <span m='104990'>our</span> <span m='105120'>modest</span>\
  \ <span m='105570'>hardware.</span> </p><p><span m='107300'>As</span> <span m='107430'>we\u2019\
  ll</span> <span m='107530'>see</span> <span m='107760'>in</span> <span m='107860'>Part</span>\
  \ <span m='108360'>3</span> <span m='108390'>of</span> <span m='108530'>the</span>\
  \ <span m='108640'>course,</span> <span m='109220'>the</span> <span m='109500'>exception</span>\
  \ <span m='110070'>hardware</span> <span m='110520'>will</span> <span m='110670'>be</span>\
  \ <span m='110870'>our</span> <span m='111100'>key</span> <span m='111420'>to</span>\
  \ <span m='111510'>interfacing</span> <span m='112130'>running</span> <span m='112380'>programs</span>\
  \ <span m='113020'>to</span> <span m='113140'>the</span> <span m='113300'>operating</span>\
  \ <span m='113780'>system</span> <span m='114300'>(OS)</span> <span m='114620'>and</span>\
  \ <span m='114930'>to</span> <span m='115060'>allow</span> <span m='115340'>the</span>\
  \ <span m='115620'>OS</span> <span m='116290'>to</span> <span m='116590'>deal</span>\
  \ <span m='116870'>with</span> <span m='117200'>external</span> <span m='117920'>events</span>\
  \ <span m='118380'>without</span> <span m='118830'>any</span> <span m='119050'>awareness</span>\
  \ <span m='119560'>on</span> <span m='119660'>the</span> <span m='119730'>part</span>\
  \ <span m='120020'>of</span> <span m='120100'>the</span> <span m='120180'>running</span>\
  \ <span m='120510'>program.</span> </p><p><span m='122910'>So</span> <span m='123420'>our</span>\
  \ <span m='123650'>plan</span> <span m='123990'>is</span> <span m='124160'>to</span>\
  \ <span m='124300'>interrupt</span> <span m='124820'>the</span> <span m='124950'>running</span>\
  \ <span m='125240'>program,</span> <span m='125950'>acting</span> <span m='126470'>like</span>\
  \ <span m='126620'>the</span> <span m='126720'>current</span> <span m='127040'>instruction</span>\
  \ <span m='127560'>was</span> <span m='127810'>actually</span> <span m='128370'>a</span>\
  \ <span m='128400'>procedure</span> <span m='128840'>call</span> <span m='129160'>to</span>\
  \ <span m='129250'>the</span> <span m='129350'>handler</span> <span m='129810'>code.</span>\
  \ </p><p><span m='131270'>When</span> <span m='131370'>it</span> <span m='131560'>finishes</span>\
  \ <span m='132060'>execution,</span> <span m='132940'>the</span> <span m='133150'>handler</span>\
  \ <span m='133620'>can,</span> <span m='134210'>if</span> <span m='134440'>appropriate,</span>\
  \ <span m='135350'>use</span> <span m='135830'>the</span> <span m='135910'>normal</span>\
  \ <span m='136260'>procedure</span> <span m='136750'>return</span> <span m='137160'>sequence</span>\
  \ <span m='138000'>to</span> <span m='138310'>resume</span> <span m='138850'>execution</span>\
  \ <span m='139510'>of</span> <span m='139600'>the</span> <span m='139700'>user</span>\
  \ <span m='139960'>program.</span> </p><p><span m='141420'>We\u2019ll</span> <span\
  \ m='141570'>use</span> <span m='141760'>the</span> <span m='141830'>term</span>\
  \ <span m='142070'>\u201Cexception\u201D</span> <span m='142730'>to</span> <span\
  \ m='142840'>refer</span> <span m='143200'>to</span> <span m='143360'>exceptions</span>\
  \ <span m='144040'>caused</span> <span m='144360'>by</span> <span m='144550'>executing</span>\
  \ <span m='145190'>the</span> <span m='145250'>current</span> <span m='145590'>program.</span>\
  \ </p><p><span m='146730'>Such</span> <span m='146960'>exceptions</span> <span m='147600'>are</span>\
  \ <span m='147730'>\u201Csynchronous\u201D</span> <span m='148640'>in</span> <span\
  \ m='148940'>the</span> <span m='149010'>sense</span> <span m='149420'>that</span>\
  \ <span m='149560'>they</span> <span m='149750'>are</span> <span m='149880'>triggered</span>\
  \ <span m='150430'>by</span> <span m='150660'>executing</span> <span m='151360'>a</span>\
  \ <span m='151410'>particular</span> <span m='152110'>instruction.</span> </p><p><span\
  \ m='153640'>In</span> <span m='153730'>other</span> <span m='153890'>words,</span>\
  \ <span m='154470'>if</span> <span m='154790'>the</span> <span m='154880'>program</span>\
  \ <span m='155630'>was</span> <span m='155840'>re-run</span> <span m='156380'>with</span>\
  \ <span m='156490'>the</span> <span m='156550'>same</span> <span m='156920'>data,</span>\
  \ <span m='157370'>the</span> <span m='157550'>same</span> <span m='157860'>exception</span>\
  \ <span m='158380'>would</span> <span m='158540'>occur.</span> </p><p><span m='160200'>We\u2019\
  ll</span> <span m='160350'>use</span> <span m='160550'>the</span> <span m='160620'>term</span>\
  \ <span m='160980'>\u201Cinterrupt\u201D</span> <span m='161570'>to</span> <span\
  \ m='161770'>refer</span> <span m='162210'>to</span> <span m='162410'>asynchronous</span>\
  \ <span m='163110'>exceptions</span> <span m='163680'>resulting</span> <span m='164180'>from</span>\
  \ <span m='164360'>external</span> <span m='164900'>events</span> <span m='165400'>whose</span>\
  \ <span m='165730'>timing</span> <span m='166230'>is</span> <span m='166430'>unrelated</span>\
  \ <span m='167280'>to</span> <span m='167460'>the</span> <span m='167560'>currently</span>\
  \ <span m='168030'>running</span> <span m='168360'>program.</span> </p><p><span\
  \ m='170090'>The</span> <span m='170310'>implementation</span> <span m='171110'>for</span>\
  \ <span m='171260'>both</span> <span m='171580'>types</span> <span m='171940'>of</span>\
  \ <span m='172040'>exceptions</span> <span m='172730'>is</span> <span m='172890'>the</span>\
  \ <span m='172970'>same.</span> </p><p><span m='174420'>When</span> <span m='174590'>an</span>\
  \ <span m='174670'>exception</span> <span m='175200'>is</span> <span m='175410'>detected,</span>\
  \ <span m='176000'>the</span> <span m='176170'>Beta</span> <span m='176430'>hardware</span>\
  \ <span m='177190'>will</span> <span m='177400'>behave</span> <span m='177960'>as</span>\
  \ <span m='178140'>if</span> <span m='178470'>the</span> <span m='178560'>current</span>\
  \ <span m='178900'>instruction</span> <span m='179560'>was</span> <span m='179720'>a</span>\
  \ <span m='179840'>taken</span> <span m='180250'>BR</span> <span m='180770'>to</span>\
  \ <span m='181300'>either</span> <span m='181600'>location</span> <span m='182130'>0x4</span>\
  \ <span m='182220'>(for</span> <span m='182930'>synchronous</span> <span m='183670'>exceptions)</span>\
  \ <span m='184350'>or</span> <span m='184520'>location</span> <span m='185220'>0x8</span>\
  \ <span m='185800'>(for</span> <span m='186120'>asynchronous</span> <span m='186830'>interrupts).</span>\
  \ </p><p><span m='188300'>Presumably</span> <span m='188870'>the</span> <span m='189030'>instructions</span>\
  \ <span m='189800'>in</span> <span m='190010'>those</span> <span m='190330'>locations</span>\
  \ <span m='190940'>will</span> <span m='191080'>jump</span> <span m='191360'>to</span>\
  \ <span m='191470'>the</span> <span m='191660'>entry</span> <span m='191980'>points</span>\
  \ <span m='192470'>of</span> <span m='192580'>the</span> <span m='192720'>appropriate</span>\
  \ <span m='193340'>handler</span> <span m='193810'>routines.</span> </p><p><span\
  \ m='196200'>We\u2019ll</span> <span m='196300'>save</span> <span m='196620'>the</span>\
  \ <span m='196720'>PC+4</span> <span m='197430'>value</span> <span m='198180'>of</span>\
  \ <span m='198270'>the</span> <span m='198450'>interrupted</span> <span m='198950'>program</span>\
  \ <span m='199500'>into</span> <span m='199780'>R30,</span> <span m='200290'>a</span>\
  \ <span m='200800'>register</span> <span m='201700'>dedicated</span> <span m='202370'>to</span>\
  \ <span m='202480'>that</span> <span m='202720'>purpose.</span> </p><p><span m='204170'>We\u2019\
  ll</span> <span m='204270'>call</span> <span m='204530'>that</span> <span m='204720'>register</span>\
  \ <span m='205230'>XP</span> <span m='206110'>(\u201Cexception</span> <span m='206810'>pointer\u201D\
  )</span> <span m='207480'>to</span> <span m='207830'>remind</span> <span m='208280'>ourselves</span>\
  \ <span m='208840'>of</span> <span m='208940'>how</span> <span m='209150'>we\u2019\
  re</span> <span m='209290'>using</span> <span m='209660'>it.</span> </p><p><span\
  \ m='210680'>Since</span> <span m='210970'>interrupts</span> <span m='211540'>in</span>\
  \ <span m='211650'>particular</span> <span m='212210'>can</span> <span m='212380'>happen</span>\
  \ <span m='212750'>at</span> <span m='212910'>any</span> <span m='213140'>point</span>\
  \ <span m='213520'>during</span> <span m='213850'>a</span> <span m='213900'>program\u2019\
  s</span> <span m='214460'>execution,</span> <span m='215440'>thus</span> <span m='215910'>overwriting</span>\
  \ <span m='216490'>the</span> <span m='216560'>contents</span> <span m='217240'>of</span>\
  \ <span m='217360'>XP</span> <span m='217850'>at</span> <span m='217930'>any</span>\
  \ <span m='218150'>time,</span> <span m='219000'>user</span> <span m='219630'>programs</span>\
  \ <span m='220190'>can\u2019t</span> <span m='220440'>use</span> <span m='220770'>the</span>\
  \ <span m='220930'>XP</span> <span m='221280'>register</span> <span m='221890'>to</span>\
  \ <span m='222120'>hold</span> <span m='222460'>values</span> <span m='223160'>since</span>\
  \ <span m='223510'>those</span> <span m='223820'>values</span> <span m='224280'>might</span>\
  \ <span m='224490'>disappear</span> <span m='225140'>at</span> <span m='225210'>any</span>\
  \ <span m='225390'>moment!</span> </p><p><span m='227630'>Here\u2019s</span> <span\
  \ m='227870'>how</span> <span m='228030'>this</span> <span m='228240'>scheme</span>\
  \ <span m='228580'>works:</span> </p><p><span m='229510'>suppose</span> <span m='230020'>we</span>\
  \ <span m='230150'>don\u2019t</span> <span m='230420'>include</span> <span m='230870'>hardware</span>\
  \ <span m='231400'>to</span> <span m='231530'>implement</span> <span m='232000'>the</span>\
  \ <span m='232080'>DIV</span> <span m='232370'>instruction,</span> <span m='233200'>so</span>\
  \ <span m='233540'>it\u2019s</span> <span m='233700'>treated</span> <span m='234130'>as</span>\
  \ <span m='234360'>an</span> <span m='234480'>illegal</span> <span m='235000'>opcode.</span>\
  \ </p><p><span m='236890'>The</span> <span m='237040'>exception</span> <span m='237620'>hardware</span>\
  \ <span m='238060'>forces</span> <span m='238560'>a</span> <span m='238600'>procedure</span>\
  \ <span m='239110'>call</span> <span m='239390'>to</span> <span m='239540'>location</span>\
  \ <span m='240070'>0x4,</span> <span m='240610'>which</span> <span m='241300'>then</span>\
  \ <span m='241550'>branches</span> <span m='242050'>to</span> <span m='242180'>the</span>\
  \ <span m='242360'>Illop</span> <span m='242840'>handler</span> <span m='243280'>shown</span>\
  \ <span m='243640'>here.</span> </p><p><span m='245240'>The</span> <span m='245330'>PC+4</span>\
  \ <span m='246120'>value</span> <span m='247160'>of</span> <span m='247500'>the</span>\
  \ <span m='247580'>DIV</span> <span m='247860'>instruction</span> <span m='248450'>has</span>\
  \ <span m='248680'>been</span> <span m='248850'>saved</span> <span m='249470'>in</span>\
  \ <span m='249610'>the</span> <span m='249780'>XP</span> <span m='250230'>register,</span>\
  \ <span m='251000'>so</span> <span m='251380'>the</span> <span m='251480'>handler</span>\
  \ <span m='251940'>can</span> <span m='252130'>fetch</span> <span m='252540'>the</span>\
  \ <span m='252710'>illegal</span> <span m='253060'>instruction</span> <span m='253780'>and,</span>\
  \ <span m='254340'>if</span> <span m='254580'>it</span> <span m='254680'>can,</span>\
  \ <span m='255350'>emulate</span> <span m='255980'>its</span> <span m='256180'>operation</span>\
  \ <span m='256810'>in</span> <span m='256899'>software.</span> </p><p><span m='258690'>When</span>\
  \ <span m='258940'>handler</span> <span m='259640'>is</span> <span m='259820'>complete,</span>\
  \ <span m='260550'>it</span> <span m='260800'>can</span> <span m='260930'>resume</span>\
  \ <span m='261459'>execution</span> <span m='262060'>of</span> <span m='262170'>the</span>\
  \ <span m='262370'>original</span> <span m='262740'>program</span> <span m='263340'>at</span>\
  \ <span m='263500'>the</span> <span m='263640'>instruction</span> <span m='264320'>following</span>\
  \ <span m='264830'>DIV</span> <span m='265160'>by</span> <span m='265370'>performing</span>\
  \ <span m='265950'>a</span> <span m='266020'>JMP(XP).</span> </p><p><span m='267740'>Pretty</span>\
  \ <span m='267960'>neat!</span> </p><p><span m='269830'>To</span> <span m='269920'>handle</span>\
  \ <span m='270360'>exceptions,</span> <span m='271060'>we</span> <span m='271230'>only</span>\
  \ <span m='271490'>need</span> <span m='271600'>a</span> <span m='271660'>few</span>\
  \ <span m='272010'>simple</span> <span m='272370'>changes</span> <span m='272910'>to</span>\
  \ <span m='273050'>the</span> <span m='273130'>datapath.</span> </p><p><span m='274960'>We\u2019\
  ve</span> <span m='275140'>added</span> <span m='275480'>a</span> <span m='275530'>MUX</span>\
  \ <span m='275920'>controlled</span> <span m='276390'>by</span> <span m='276580'>the</span>\
  \ <span m='276960'>WASEL</span> <span m='277520'>signal</span> <span m='277910'>to</span>\
  \ <span m='278030'>choose</span> <span m='278440'>the</span> <span m='278550'>write-back</span>\
  \ <span m='279100'>address</span> <span m='279570'>for</span> <span m='279730'>the</span>\
  \ <span m='279860'>register</span> <span m='280310'>file.</span> </p><p><span m='281680'>When</span>\
  \ <span m='282000'>WASEL</span> <span m='282770'>is</span> <span m='283070'>1,</span>\
  \ <span m='283540'>write-back</span> <span m='284340'>will</span> <span m='284500'>occur</span>\
  \ <span m='284770'>to</span> <span m='284850'>the</span> <span m='285040'>XP</span>\
  \ <span m='285550'>register,</span> <span m='286140'>i.e.,</span> <span m='286530'>register</span>\
  \ <span m='287520'>30.</span> </p><p><span m='288720'>When</span> <span m='289010'>WASEL</span>\
  \ <span m='289630'>is</span> <span m='290000'>0,</span> <span m='290440'>write-back</span>\
  \ <span m='291290'>will</span> <span m='291440'>occur</span> <span m='291730'>normally,</span>\
  \ <span m='292620'>i.e.,</span> <span m='293130'>to</span> <span m='293330'>the</span>\
  \ <span m='293460'>register</span> <span m='293970'>specified</span> <span m='294620'>by</span>\
  \ <span m='294750'>the</span> <span m='294940'>RC</span> <span m='295420'>field</span>\
  \ <span m='295740'>of</span> <span m='295850'>the</span> <span m='295960'>current</span>\
  \ <span m='296280'>instruction.</span> </p><p><span m='298520'>The</span> <span\
  \ m='298610'>remaining</span> <span m='299160'>two</span> <span m='299450'>inputs</span>\
  \ <span m='300010'>of</span> <span m='300090'>the</span> <span m='300180'>PCSEL</span>\
  \ <span m='300890'>MUX</span> <span m='301230'>are</span> <span m='301300'>set</span>\
  \ <span m='301550'>to</span> <span m='301670'>the</span> <span m='301750'>constant</span>\
  \ <span m='302220'>addresses</span> <span m='302820'>for</span> <span m='303010'>the</span>\
  \ <span m='303140'>exception</span> <span m='303600'>handlers.</span> </p><p><span\
  \ m='304750'>In</span> <span m='304870'>our</span> <span m='305060'>case,</span>\
  \ <span m='305450'>0x4</span> <span m='305610'>for</span> <span m='306280'>illegal</span>\
  \ <span m='306770'>operations,</span> <span m='307620'>and</span> <span m='307880'>0x8</span>\
  \ <span m='308280'>for</span> <span m='308550'>interrupts.</span> </p><p><span m='310920'>Here\u2019\
  s</span> <span m='311140'>the</span> <span m='311240'>flow</span> <span m='311550'>of</span>\
  \ <span m='311660'>control</span> <span m='312290'>during</span> <span m='312710'>an</span>\
  \ <span m='312890'>exception.</span> </p><p><span m='314280'>The</span> <span m='314380'>PC+4</span>\
  \ <span m='315080'>value</span> <span m='315770'>for</span> <span m='315960'>the</span>\
  \ <span m='316150'>interrupted</span> <span m='316660'>instruction</span> <span\
  \ m='317250'>is</span> <span m='317410'>routed</span> <span m='317760'>through</span>\
  \ <span m='317950'>the</span> <span m='318190'>WDSEL</span> <span m='318870'>MUX</span>\
  \ <span m='319240'>to</span> <span m='319330'>be</span> <span m='319500'>written</span>\
  \ <span m='319830'>into</span> <span m='320070'>the</span> <span m='320250'>XP</span>\
  \ <span m='320740'>register.</span> </p><p><span m='322330'>Meanwhile</span> <span\
  \ m='322860'>the</span> <span m='322940'>control</span> <span m='323450'>logic</span>\
  \ <span m='323830'>chooses</span> <span m='324420'>either</span> <span m='325010'>3</span>\
  \ <span m='325490'>or</span> <span m='326150'>4</span> <span m='326220'>as</span>\
  \ <span m='326370'>the</span> <span m='326470'>value</span> <span m='326990'>of</span>\
  \ <span m='327230'>PCSEL</span> <span m='328160'>to</span> <span m='328410'>select</span>\
  \ <span m='328870'>the</span> <span m='329020'>appropriate</span> <span m='329680'>next</span>\
  \ <span m='330000'>instruction</span> <span m='330840'>that</span> <span m='331180'>will</span>\
  \ <span m='331360'>initiate</span> <span m='331920'>the</span> <span m='332030'>handling</span>\
  \ <span m='332670'>the</span> <span m='332840'>exception.</span> </p><p><span m='334930'>The</span>\
  \ <span m='335010'>remaining</span> <span m='335470'>control</span> <span m='335920'>signals</span>\
  \ <span m='336430'>are</span> <span m='336530'>forced</span> <span m='336970'>to</span>\
  \ <span m='337050'>their</span> <span m='337210'>\u201Cdon\u2019t</span> <span m='337510'>care\u201D\
  </span> <span m='337880'>values,</span> <span m='338470'>since</span> <span m='338770'>we</span>\
  \ <span m='338870'>no</span> <span m='339060'>longer</span> <span m='339460'>care</span>\
  \ <span m='339800'>about</span> <span m='340060'>completing</span> <span m='340720'>execution</span>\
  \ <span m='341380'>of</span> <span m='341470'>the</span> <span m='341600'>instruction</span>\
  \ <span m='342400'>we</span> <span m='342670'>had</span> <span m='342850'>fetched</span>\
  \ <span m='343280'>from</span> <span m='343460'>main</span> <span m='343710'>memory</span>\
  \ <span m='344150'>at</span> <span m='344310'>the</span> <span m='344410'>beginning</span>\
  \ <span m='344910'>of</span> <span m='345010'>the</span> <span m='345100'>cycle.</span>\
  \ </p><p><span m='346980'>Note</span> <span m='347200'>that</span> <span m='347350'>the</span>\
  \ <span m='347520'>interrupted</span> <span m='348130'>instruction</span> <span\
  \ m='348740'>has</span> <span m='349060'>not</span> <span m='349420'>been</span>\
  \ <span m='349740'>executed.</span> </p><p><span m='350900'>So</span> <span m='351090'>if</span>\
  \ <span m='351180'>the</span> <span m='351330'>exception</span> <span m='351860'>handler</span>\
  \ <span m='352260'>wishes</span> <span m='352610'>to</span> <span m='352800'>execute</span>\
  \ <span m='353350'>the</span> <span m='353480'>interrupted</span> <span m='353960'>instruction,</span>\
  \ <span m='355030'>it</span> <span m='355500'>will</span> <span m='355660'>have</span>\
  \ <span m='355870'>to</span> <span m='355980'>subtract</span> <span m='356500'>4</span>\
  \ <span m='356530'>from</span> <span m='356980'>the</span> <span m='357210'>value</span>\
  \ <span m='357640'>in</span> <span m='357700'>the</span> <span m='357850'>XP</span>\
  \ <span m='358260'>register</span> <span m='358930'>before</span> <span m='359590'>performing</span>\
  \ <span m='360250'>a</span> <span m='360340'>JMP(XP)</span> <span m='361000'>to</span>\
  \ <span m='361300'>resume</span> <span m='361950'>execution</span> <span m='362690'>of</span>\
  \ <span m='362780'>the</span> <span m='362940'>interrupted</span> <span m='363480'>program.</span>\
  \ </p>"
type: course
uid: 44cf90e6488547f11e513f0eeffbd665

---
None