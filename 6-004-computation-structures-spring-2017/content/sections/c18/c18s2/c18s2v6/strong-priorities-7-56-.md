---
about_this_resource_text: ''
course_id: 6-004-computation-structures-spring-2017
embedded_media:
- id: Video-YouTube-Stream
  media_location: PmOq8G_hs4o
  parent_uid: 66ed3f3a0ae0de34be5a395b50481d2f
  title: Video-YouTube-Stream
  type: Video
  uid: 39deb2caee85d7dcc349fe3d35ad073a
- id: 3Play-3Play YouTube id-Stream
  media_location: PmOq8G_hs4o
  parent_uid: 66ed3f3a0ae0de34be5a395b50481d2f
  title: 3Play-3Play YouTube id
  type: 3Play
  uid: c996d2634650171d32d0f05feda2283b
- id: Thumbnail-YouTube-JPG_1
  media_location: https://img.youtube.com/vi/PmOq8G_hs4o/default.jpg
  parent_uid: 66ed3f3a0ae0de34be5a395b50481d2f
  title: Thumbnail-YouTube-JPG
  type: Thumbnail
  uid: 0c134dc642bfdc0d9a9a77d052e27644
- id: PmOq8G_hs4o.srt
  parent_uid: 66ed3f3a0ae0de34be5a395b50481d2f
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-004-computation-structures-spring-2017/c18/c18s2/c18s2v6/strong-priorities-7-56-/PmOq8G_hs4o.srt
  title: 3play caption file
  type: null
  uid: 89e96b9e22e9b6f1272b7e695c7238c7
- id: PmOq8G_hs4o.pdf
  parent_uid: 66ed3f3a0ae0de34be5a395b50481d2f
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-004-computation-structures-spring-2017/c18/c18s2/c18s2v6/strong-priorities-7-56-/PmOq8G_hs4o.pdf
  title: 3play pdf file
  type: null
  uid: 806d9639bf2afb306ee9a2c9913fba63
- id: Caption-3Play YouTube id-SRT
  parent_uid: 66ed3f3a0ae0de34be5a395b50481d2f
  title: Caption-3Play YouTube id-SRT-English - US
  type: Caption
  uid: a05014a8eb01664687157c6f48acc2dd
- id: Transcript-3Play YouTube id-PDF
  parent_uid: 66ed3f3a0ae0de34be5a395b50481d2f
  title: Transcript-3Play YouTube id-PDF-English - US
  type: Transcript
  uid: 91719494d51f2e64fe9892d9e60b25a5
- id: Video-InternetArchive-MP4
  media_location: https://archive.org/download/MIT6.004S17/MIT6_004S17_18-02-06_300k.mp4
  parent_uid: 66ed3f3a0ae0de34be5a395b50481d2f
  title: Video-Internet Archive-MP4
  type: Video
  uid: 7f272986582c5a4f00e635997fbb08ce
inline_embed_id: 52517795strongpriorities75640273926
layout: video
order_index: null
parent_uid: e3f8430571bfb24f2166515059b5089c
related_resources_text: ''
short_url: strong-priorities-7-56-
technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-004-computation-structures-spring-2017/c18/c18s2/c18s2v6/strong-priorities-7-56-
template_type: Embed
title: Strong Priorities (7:56)
transcript: <p><span m='969'>In</span> <span m='1280'>a</span> <span m='1592'>weak</span>
  <span m='1903'>priority</span> <span m='2215'>system</span> <span m='2526'>the</span>
  <span m='2838'>currently-running</span> <span m='3149'>task</span> <span m='3461'>will</span>
  <span m='3772'>always</span> <span m='4084'>run</span> <span m='4395'>to</span>
  <span m='4707'>completion</span> <span m='5018'>before</span> <span m='5330'>considering</span>
  <span m='5858'>what</span> <span m='6386'>to</span> <span m='6914'>run</span> <span
  m='7442'>next.</span> </p><p><span m='7970'>This</span> <span m='8296'>means</span>
  <span m='8623'>the</span> <span m='8949'>worst-case</span> <span m='9276'>latency</span>
  <span m='9602'>for</span> <span m='9929'>a</span> <span m='10255'>device</span>
  <span m='10582'>always</span> <span m='10908'>includes</span> <span m='11235'>the</span>
  <span m='11561'>worst-case</span> <span m='11888'>service</span> <span m='12214'>time</span>
  <span m='12541'>across</span> <span m='12866'>all</span> <span m='13192'>the</span>
  <span m='13517'>other</span> <span m='13843'>devices,</span> <span m='14168'>i.e.,</span>
  <span m='14494'>the</span> <span m='14820'>maximum</span> <span m='15145'>time</span>
  <span m='15471'>we</span> <span m='15796'>have</span> <span m='16122'>to</span>
  <span m='16447'>wait</span> <span m='16773'>for</span> <span m='17099'>the</span>
  <span m='17829'>currently-running</span> <span m='18559'>task</span> <span m='19289'>to</span>
  <span m='20019'>complete.</span> </p><p><span m='20749'>If</span> <span m='21055'>there's</span>
  <span m='21362'>a</span> <span m='21669'>long-running</span> <span m='21975'>task</span>
  <span m='22282'>that</span> <span m='22589'>usually</span> <span m='22895'>means</span>
  <span m='23202'>it</span> <span m='23509'>will</span> <span m='23815'>be</span>
  <span m='24122'>impossible</span> <span m='24429'>to</span> <span m='24735'>meet</span>
  <span m='25042'>tight</span> <span m='25349'>deadlines</span> <span m='25841'>for</span>
  <span m='26334'>other</span> <span m='26827'>tasks.</span> </p><p><span m='27320'>For</span>
  <span m='27651'>example,</span> <span m='27983'>suppose</span> <span m='28315'>disk</span>
  <span m='28647'>requests</span> <span m='28979'>have</span> <span m='29311'>a</span>
  <span m='29643'>800</span> <span m='29975'>us</span> <span m='30307'>deadline</span>
  <span m='30639'>in</span> <span m='30971'>order</span> <span m='31303'>to</span>
  <span m='31635'>guarantee</span> <span m='31967'>the</span> <span m='32299'>best</span>
  <span m='32689'>throughput</span> <span m='33079'>from</span> <span m='33469'>the</span>
  <span m='33859'>disk</span> <span m='34249'>subsystem.</span> </p><p><span m='34640'>Since</span>
  <span m='35090'>the</span> <span m='35541'>disk</span> <span m='35992'>handler</span>
  <span m='36442'>service</span> <span m='36893'>time</span> <span m='37344'>is</span>
  <span m='37795'>500</span> <span m='38245'>us,</span> <span m='38696'>the</span>
  <span m='39147'>maximum</span> <span m='39597'>allowable</span> <span m='40048'>latency</span>
  <span m='40499'>between</span> <span m='40950'>a</span> <span m='41385'>disk</span>
  <span m='41820'>request</span> <span m='42255'>and</span> <span m='42690'>starting</span>
  <span m='43125'>to</span> <span m='43560'>execute</span> <span m='43995'>the</span>
  <span m='44430'>disk</span> <span m='44865'>service</span> <span m='45300'>routine</span>
  <span m='45735'>is</span> <span m='46170'>300</span> <span m='46605'>us.</span>
  </p><p><span m='47040'>Oops!</span> </p><p><span m='48040'>The</span> <span m='48393'>weak</span>
  <span m='48747'>priority</span> <span m='49101'>scheme</span> <span m='49455'>can</span>
  <span m='49808'>only</span> <span m='50162'>guarantee</span> <span m='50516'>a</span>
  <span m='50870'>maximum</span> <span m='51223'>latency</span> <span m='51577'>of</span>
  <span m='51931'>800</span> <span m='52285'>us,</span> <span m='52638'>not</span>
  <span m='52992'>nearly</span> <span m='53346'>fast</span> <span m='53700'>enough</span>
  <span m='54123'>to</span> <span m='54546'>meet</span> <span m='54970'>the</span>
  <span m='55393'>disk</span> <span m='55816'>deadline.</span> </p><p><span m='56240'>We</span>
  <span m='56732'>can't</span> <span m='57224'>meet</span> <span m='57716'>the</span>
  <span m='58208'>disk</span> <span m='58701'>deadline</span> <span m='59193'>using</span>
  <span m='59685'>weak</span> <span m='60177'>priorities.</span> </p><p><span m='60670'>We</span>
  <span m='61064'>need</span> <span m='61459'>to</span> <span m='61854'>introduce</span>
  <span m='62249'>a</span> <span m='62644'>preemptive</span> <span m='63039'>priority</span>
  <span m='63434'>system</span> <span m='63829'>that</span> <span m='64224'>allows</span>
  <span m='64619'>lower-priority</span> <span m='65014'>handlers</span> <span m='65409'>to</span>
  <span m='66034'>be</span> <span m='66659'>interrupted</span> <span m='67284'>by</span>
  <span m='67909'>higher-priority</span> <span m='68534'>requests.</span> </p><p><span
  m='69159'>We'll</span> <span m='69620'>refer</span> <span m='70081'>to</span> <span
  m='70542'>this</span> <span m='71003'>as</span> <span m='71465'>a</span> <span m='71926'>"strong"</span>
  <span m='72387'>priority</span> <span m='72848'>system.</span> </p><p><span m='73310'>Suppose</span>
  <span m='73566'>we</span> <span m='73822'>gave</span> <span m='74079'>the</span>
  <span m='74335'>disk</span> <span m='74592'>the</span> <span m='74848'>highest</span>
  <span m='75105'>priority,</span> <span m='75361'>the</span> <span m='75617'>printer</span>
  <span m='75874'>second</span> <span m='76130'>priority,</span> <span m='76387'>and</span>
  <span m='76643'>keyboard</span> <span m='76900'>the</span> <span m='77330'>lowest</span>
  <span m='77760'>priority,</span> <span m='78190'>just</span> <span m='78620'>like</span>
  <span m='79050'>we</span> <span m='79480'>did</span> <span m='79910'>before.</span>
  </p><p><span m='80340'>Now</span> <span m='80674'>when</span> <span m='81009'>a</span>
  <span m='81344'>disk</span> <span m='81678'>request</span> <span m='82013'>arrives,</span>
  <span m='82348'>it</span> <span m='82682'>will</span> <span m='83017'>start</span>
  <span m='83352'>executing</span> <span m='83686'>immediately</span> <span m='84021'>without</span>
  <span m='84356'>having</span> <span m='84690'>to</span> <span m='85025'>wait</span>
  <span m='85360'>for</span> <span m='85796'>the</span> <span m='86232'>completion</span>
  <span m='86668'>of</span> <span m='87104'>the</span> <span m='87540'>lower-priority</span>
  <span m='87976'>printer</span> <span m='88412'>or</span> <span m='88848'>keyboard</span>
  <span m='89284'>handlers.</span> </p><p><span m='89720'>The</span> <span m='90102'>worst-case</span>
  <span m='90485'>latency</span> <span m='90868'>for</span> <span m='91251'>the</span>
  <span m='91634'>disk</span> <span m='92017'>has</span> <span m='92400'>dropped</span>
  <span m='92783'>to</span> <span m='93166'>0.</span> </p><p><span m='93549'>The</span>
  <span m='93989'>printer</span> <span m='94429'>can</span> <span m='94869'>only</span>
  <span m='95309'>be</span> <span m='95749'>preempted</span> <span m='96189'>by</span>
  <span m='96629'>the</span> <span m='97069'>disk,</span> <span m='97509'>so</span>
  <span m='97949'>it's</span> <span m='98389'>worst-case</span> <span m='98829'>latency</span>
  <span m='99269'>is</span> <span m='99709'>500</span> <span m='100149'>us.</span>
  </p><p><span m='100590'>Since</span> <span m='100939'>it</span> <span m='101288'>has</span>
  <span m='101638'>the</span> <span m='101987'>lowest</span> <span m='102336'>priority,</span>
  <span m='102686'>the</span> <span m='103035'>worst-case</span> <span m='103385'>latency</span>
  <span m='103734'>for</span> <span m='104083'>the</span> <span m='104433'>keyboard</span>
  <span m='104782'>is</span> <span m='105131'>unchanged</span> <span m='105481'>at</span>
  <span m='105830'>900</span> <span m='106180'>us</span> <span m='106481'>since</span>
  <span m='106783'>it</span> <span m='107084'>might</span> <span m='107386'>still</span>
  <span m='107687'>have</span> <span m='107989'>to</span> <span m='108290'>wait</span>
  <span m='108592'>on</span> <span m='108893'>the</span> <span m='109195'>disk</span>
  <span m='109496'>and</span> <span m='109798'>printer.</span> </p><p><span m='110100'>The</span>
  <span m='110452'>good</span> <span m='110804'>news:</span> <span m='111156'>with</span>
  <span m='111509'>the</span> <span m='111861'>proper</span> <span m='112213'>assignment</span>
  <span m='112566'>of</span> <span m='112918'>priorities,</span> <span m='113270'>the</span>
  <span m='113623'>strong</span> <span m='113975'>priority</span> <span m='114327'>system</span>
  <span m='114680'>can</span> <span m='115158'>guarantee</span> <span m='115636'>that</span>
  <span m='116115'>disk</span> <span m='116593'>requests</span> <span m='117072'>will</span>
  <span m='117550'>be</span> <span m='118029'>serviced</span> <span m='118507'>by</span>
  <span m='118986'>the</span> <span m='119464'>800</span> <span m='119943'>us</span>
  <span m='120421'>deadline.</span> </p><p><span m='120900'>We'll</span> <span m='121192'>need</span>
  <span m='121484'>to</span> <span m='121776'>make</span> <span m='122069'>a</span>
  <span m='122361'>small</span> <span m='122653'>tweak</span> <span m='122946'>to</span>
  <span m='123238'>our</span> <span m='123530'>Beta</span> <span m='123822'>hardware</span>
  <span m='124115'>to</span> <span m='124407'>implement</span> <span m='124699'>a</span>
  <span m='124992'>strong</span> <span m='125284'>priority</span> <span m='125576'>system.</span>
  </p><p><span m='125869'>We'll</span> <span m='126359'>replace</span> <span m='126850'>the</span>
  <span m='127341'>single</span> <span m='127831'>supervisor</span> <span m='128322'>mode</span>
  <span m='128813'>bit</span> <span m='129304'>in</span> <span m='129794'>PC[31]</span>
  <span m='130285'>with,</span> <span m='130776'>say,</span> <span m='131267'>a</span>
  <span m='131757'>three-bit</span> <span m='132248'>field</span> <span m='132739'>(PRI)</span>
  <span m='133230'>in</span> <span m='133664'>PC[31:29]</span> <span m='134098'>that</span>
  <span m='134532'>indicates</span> <span m='134967'>which</span> <span m='135401'>of</span>
  <span m='135835'>the</span> <span m='136270'>eight</span> <span m='136704'>priority</span>
  <span m='137138'>levels</span> <span m='137572'>the</span> <span m='138007'>processor</span>
  <span m='138441'>is</span> <span m='138875'>currently</span> <span m='139310'>running</span>
  <span m='139810'>at.</span> </p><p><span m='140310'>Next,</span> <span m='140763'>we'll</span>
  <span m='141217'>modify</span> <span m='141671'>the</span> <span m='142125'>interrupt</span>
  <span m='142578'>mechanism</span> <span m='143032'>as</span> <span m='143486'>follows.</span>
  </p><p><span m='143940'>In</span> <span m='144418'>addition</span> <span m='144896'>to</span>
  <span m='145375'>requesting</span> <span m='145853'>an</span> <span m='146332'>interrupt,</span>
  <span m='146810'>the</span> <span m='147289'>requesting</span> <span m='147767'>device</span>
  <span m='148246'>also</span> <span m='148724'>specifies</span> <span m='149203'>the</span>
  <span m='149681'>3-bit</span> <span m='150160'>priority</span> <span m='150460'>it</span>
  <span m='150760'>was</span> <span m='151060'>assigned</span> <span m='151360'>by</span>
  <span m='151660'>the</span> <span m='151960'>system</span> <span m='152260'>architect.</span>
  </p><p><span m='152560'>We'll</span> <span m='152892'>add</span> <span m='153224'>a</span>
  <span m='153556'>priority</span> <span m='153888'>encoder</span> <span m='154220'>circuit</span>
  <span m='154552'>to</span> <span m='154885'>the</span> <span m='155217'>interrupt</span>
  <span m='155549'>hardware</span> <span m='155881'>to</span> <span m='156213'>select</span>
  <span m='156545'>the</span> <span m='156877'>highest-priority</span> <span m='157210'>request</span>
  <span m='157707'>and</span> <span m='158204'>compare</span> <span m='158701'>the</span>
  <span m='159198'>priority</span> <span m='159695'>of</span> <span m='160192'>that</span>
  <span m='160689'>request</span> <span m='161186'>(PDEV)</span> <span m='161683'>to</span>
  <span m='162180'>the</span> <span m='162677'>3-bit</span> <span m='163174'>PRI</span>
  <span m='163671'>value</span> <span m='164168'>in</span> <span m='164665'>the</span>
  <span m='165162'>PC.</span> </p><p><span m='165660'>The</span> <span m='166053'>system</span>
  <span m='166446'>will</span> <span m='166839'>take</span> <span m='167232'>the</span>
  <span m='167625'>interrupt</span> <span m='168018'>request</span> <span m='168411'>only</span>
  <span m='168805'>if</span> <span m='169198'>PDEV</span> <span m='169591'>&gt;</span>
  <span m='169984'>PRI,</span> <span m='170377'>i.e.,</span> <span m='170770'>if</span>
  <span m='171163'>the</span> <span m='171556'>priority</span> <span m='171950'>of</span>
  <span m='172290'>the</span> <span m='172631'>request</span> <span m='172972'>is</span>
  <span m='173313'>*higher*</span> <span m='173653'>than</span> <span m='173994'>the</span>
  <span m='174335'>priority</span> <span m='174676'>the</span> <span m='175016'>system</span>
  <span m='175357'>is</span> <span m='175698'>running</span> <span m='176039'>at.</span>
  </p><p><span m='176380'>When</span> <span m='176745'>the</span> <span m='177110'>interrupt</span>
  <span m='177475'>is</span> <span m='177840'>taken,</span> <span m='178205'>the</span>
  <span m='178570'>old</span> <span m='178935'>PC</span> <span m='179300'>and</span>
  <span m='179665'>PRI</span> <span m='180030'>information</span> <span m='180395'>is</span>
  <span m='180760'>saved</span> <span m='181125'>in</span> <span m='181490'>XP,</span>
  <span m='181855'>and</span> <span m='182220'>the</span> <span m='182585'>new</span>
  <span m='182950'>PC</span> <span m='183292'>is</span> <span m='183634'>determined</span>
  <span m='183977'>by</span> <span m='184319'>the</span> <span m='184661'>type</span>
  <span m='185004'>of</span> <span m='185346'>interrupt</span> <span m='185688'>and</span>
  <span m='186031'>the</span> <span m='186373'>new</span> <span m='186715'>PRI</span>
  <span m='187058'>field</span> <span m='187400'>is</span> <span m='187742'>set</span>
  <span m='188085'>to</span> <span m='188427'>PDEV.</span> </p><p><span m='188770'>So</span>
  <span m='189161'>the</span> <span m='189552'>processor</span> <span m='189944'>will</span>
  <span m='190335'>now</span> <span m='190726'>be</span> <span m='191118'>running</span>
  <span m='191509'>at</span> <span m='191900'>the</span> <span m='192292'>higher</span>
  <span m='192683'>priority</span> <span m='193074'>specified</span> <span m='193466'>by</span>
  <span m='193857'>the</span> <span m='194248'>device.</span> </p><p><span m='194640'>A</span>
  <span m='195094'>strong</span> <span m='195548'>priority</span> <span m='196002'>system</span>
  <span m='196456'>allows</span> <span m='196910'>low-priority</span> <span m='197365'>handlers</span>
  <span m='197819'>to</span> <span m='198273'>be</span> <span m='198727'>interrupted</span>
  <span m='199181'>by</span> <span m='199635'>higher-priority</span> <span m='200090'>requests,</span>
  <span m='200544'>so</span> <span m='200998'>the</span> <span m='201453'>worst-case</span>
  <span m='201907'>latency</span> <span m='202362'>seen</span> <span m='202816'>at</span>
  <span m='203271'>high</span> <span m='203725'>priorities</span> <span m='204180'>is</span>
  <span m='204775'>unaffected</span> <span m='205371'>by</span> <span m='205966'>the</span>
  <span m='206562'>service</span> <span m='207157'>times</span> <span m='207753'>of</span>
  <span m='208348'>lower-priority</span> <span m='208944'>handlers.</span> </p><p><span
  m='209540'>Using</span> <span m='209837'>strong</span> <span m='210134'>priorities</span>
  <span m='210432'>allows</span> <span m='210729'>us</span> <span m='211026'>to</span>
  <span m='211324'>assign</span> <span m='211621'>a</span> <span m='211918'>high</span>
  <span m='212216'>priority</span> <span m='212513'>to</span> <span m='212810'>devices</span>
  <span m='213108'>with</span> <span m='213405'>tight</span> <span m='213702'>deadlines</span>
  <span m='214000'>and</span> <span m='214518'>thus</span> <span m='215036'>guarantee</span>
  <span m='215555'>their</span> <span m='216073'>deadlines</span> <span m='216592'>are</span>
  <span m='217110'>met.</span> </p><p><span m='217629'>Now</span> <span m='218070'>let's</span>
  <span m='218512'>consider</span> <span m='218954'>the</span> <span m='219396'>impact</span>
  <span m='219837'>of</span> <span m='220279'>recurring</span> <span m='220721'>interrupts,</span>
  <span m='221163'>i.e.,</span> <span m='221604'>multiple</span> <span m='222046'>interrupt</span>
  <span m='222488'>requests</span> <span m='222930'>from</span> <span m='223573'>each</span>
  <span m='224216'>device.</span> </p><p><span m='224860'>We've</span> <span m='225166'>added</span>
  <span m='225473'>a</span> <span m='225780'>"maximum</span> <span m='226086'>frequency"</span>
  <span m='226393'>column</span> <span m='226700'>to</span> <span m='227006'>our</span>
  <span m='227313'>table,</span> <span m='227620'>which</span> <span m='227926'>gives</span>
  <span m='228233'>the</span> <span m='228540'>maximum</span> <span m='228846'>rate</span>
  <span m='229153'>at</span> <span m='229460'>which</span> <span m='229961'>requests</span>
  <span m='230462'>will</span> <span m='230963'>be</span> <span m='231465'>generated</span>
  <span m='231966'>by</span> <span m='232467'>each</span> <span m='232968'>device.</span>
  </p><p><span m='233470'>The</span> <span m='233795'>execution</span> <span m='234120'>diagram</span>
  <span m='234446'>for</span> <span m='234771'>a</span> <span m='235096'>strong</span>
  <span m='235422'>priority</span> <span m='235747'>system</span> <span m='236073'>is</span>
  <span m='236398'>shown</span> <span m='236723'>below</span> <span m='237049'>the</span>
  <span m='237374'>table.</span> </p><p><span m='237700'>Here</span> <span m='238043'>we</span>
  <span m='238387'>see</span> <span m='238730'>there</span> <span m='239074'>are</span>
  <span m='239417'>multiple</span> <span m='239761'>requests</span> <span m='240104'>from</span>
  <span m='240448'>each</span> <span m='240791'>device,</span> <span m='241135'>in</span>
  <span m='241478'>this</span> <span m='241822'>case</span> <span m='242165'>shown</span>
  <span m='242509'>at</span> <span m='242852'>their</span> <span m='243196'>maximum</span>
  <span m='243540'>possible</span> <span m='244242'>rate</span> <span m='244944'>of</span>
  <span m='245646'>request.</span> </p><p><span m='246349'>Each</span> <span m='246775'>tick</span>
  <span m='247201'>on</span> <span m='247628'>the</span> <span m='248054'>timeline</span>
  <span m='248481'>represent</span> <span m='248907'>100</span> <span m='249334'>us</span>
  <span m='249760'>of</span> <span m='250187'>real</span> <span m='250613'>time.</span>
  </p><p><span m='251040'>Printer</span> <span m='251549'>requests</span> <span m='252059'>occur</span>
  <span m='252569'>every</span> <span m='253079'>1</span> <span m='253589'>ms</span>
  <span m='254099'>(10</span> <span m='254609'>ticks),</span> <span m='255119'>disk</span>
  <span m='255629'>requests</span> <span m='256139'>every</span> <span m='256649'>2</span>
  <span m='257159'>ms</span> <span m='257669'>(20</span> <span m='258179'>ticks),</span>
  <span m='258689'>and</span> <span m='259199'>keyboard</span> <span m='259709'>requests</span>
  <span m='260394'>every</span> <span m='261079'>10</span> <span m='261764'>ms</span>
  <span m='262449'>(100</span> <span m='263134'>ticks).</span> </p><p><span m='263820'>In</span>
  <span m='264097'>the</span> <span m='264375'>diagram</span> <span m='264652'>you</span>
  <span m='264930'>can</span> <span m='265208'>see</span> <span m='265485'>that</span>
  <span m='265763'>the</span> <span m='266041'>high-priority</span> <span m='266318'>disk</span>
  <span m='266596'>requests</span> <span m='266874'>are</span> <span m='267151'>serviced</span>
  <span m='267429'>as</span> <span m='267707'>soon</span> <span m='267984'>as</span>
  <span m='268262'>they're</span> <span m='268540'>received.</span> </p><p><span m='270290'>And</span>
  <span m='270735'>that</span> <span m='271180'>medium-priority</span> <span m='271626'>printer</span>
  <span m='272071'>requests</span> <span m='272517'>preempt</span> <span m='272962'>lower-priority</span>
  <span m='273408'>execution</span> <span m='273853'>of</span> <span m='274299'>the</span>
  <span m='274744'>keyboard</span> <span m='275190'>handler.</span> </p><p><span m='277060'>Printer</span>
  <span m='277425'>requests</span> <span m='277790'>would</span> <span m='278156'>be</span>
  <span m='278521'>preempted</span> <span m='278886'>by</span> <span m='279252'>disk</span>
  <span m='279617'>requests,</span> <span m='279983'>but</span> <span m='280348'>given</span>
  <span m='280713'>their</span> <span m='281079'>request</span> <span m='281444'>patterns,</span>
  <span m='281810'>there's</span> <span m='282131'>never</span> <span m='282453'>a</span>
  <span m='282775'>printer</span> <span m='283097'>request</span> <span m='283419'>in</span>
  <span m='283741'>progress</span> <span m='284063'>when</span> <span m='284385'>a</span>
  <span m='284706'>disk</span> <span m='285028'>request</span> <span m='285350'>arrives,</span>
  <span m='285672'>so</span> <span m='285994'>we</span> <span m='286316'>don't</span>
  <span m='286638'>see</span> <span m='286960'>that</span> <span m='287533'>happening</span>
  <span m='288106'>here.</span> </p><p><span m='288680'>The</span> <span m='289171'>maximum</span>
  <span m='289663'>latency</span> <span m='290155'>before</span> <span m='290646'>a</span>
  <span m='291138'>keyboard</span> <span m='291630'>requests</span> <span m='292121'>starts</span>
  <span m='292613'>is</span> <span m='293105'>indeed</span> <span m='293596'>900</span>
  <span m='294088'>us.</span> </p><p><span m='294580'>But</span> <span m='294887'>that</span>
  <span m='295194'>doesn't</span> <span m='295501'>tell</span> <span m='295808'>the</span>
  <span m='296115'>whole</span> <span m='296422'>story!</span> </p><p><span m='296730'>As</span>
  <span m='297080'>you</span> <span m='297430'>can</span> <span m='297780'>see,</span>
  <span m='298130'>the</span> <span m='298480'>poor</span> <span m='298830'>keyboard</span>
  <span m='299180'>handler</span> <span m='299530'>is</span> <span m='299880'>continually</span>
  <span m='300230'>preempted</span> <span m='300580'>by</span> <span m='300930'>higher-priority</span>
  <span m='301280'>disk</span> <span m='301681'>and</span> <span m='302082'>printer</span>
  <span m='302484'>requests</span> <span m='302885'>and</span> <span m='303286'>so</span>
  <span m='303688'>the</span> <span m='304089'>keyboard</span> <span m='304490'>handler</span>
  <span m='304892'>doesn't</span> <span m='305293'>complete</span> <span m='305694'>until</span>
  <span m='306096'>3</span> <span m='306497'>ms</span> <span m='306898'>after</span>
  <span m='307300'>its</span> <span m='307765'>request</span> <span m='308230'>was</span>
  <span m='308695'>received!</span> </p><p><span m='309160'>This</span> <span m='309568'>illustrates</span>
  <span m='309976'>why</span> <span m='310385'>real-time</span> <span m='310793'>constraints</span>
  <span m='311202'>are</span> <span m='311610'>best</span> <span m='312019'>expressed</span>
  <span m='312427'>in</span> <span m='312836'>terms</span> <span m='313244'>of</span>
  <span m='313653'>deadlines</span> <span m='314061'>and</span> <span m='314470'>not</span>
  <span m='315400'>latencies.</span> </p><p><span m='316330'>If</span> <span m='316649'>the</span>
  <span m='316968'>keyboard</span> <span m='317288'>deadline</span> <span m='317607'>had</span>
  <span m='317926'>been</span> <span m='318246'>less</span> <span m='318565'>that</span>
  <span m='318885'>3</span> <span m='319204'>ms,</span> <span m='319523'>even</span>
  <span m='319843'>the</span> <span m='320162'>strong</span> <span m='320481'>priority</span>
  <span m='320801'>system</span> <span m='321120'>would</span> <span m='321440'>have</span>
  <span m='321817'>failed</span> <span m='322195'>to</span> <span m='322572'>meet</span>
  <span m='322950'>the</span> <span m='323327'>hard</span> <span m='323705'>real-time</span>
  <span m='324082'>constraints.</span> </p><p><span m='324460'>The</span> <span m='324782'>reason</span>
  <span m='325105'>would</span> <span m='325427'>be</span> <span m='325750'>that</span>
  <span m='326072'>there</span> <span m='326395'>simply</span> <span m='326717'>aren't</span>
  <span m='327040'>enough</span> <span m='327362'>CPU</span> <span m='327685'>cycles</span>
  <span m='328007'>to</span> <span m='328330'>meet</span> <span m='328652'>the</span>
  <span m='328975'>recurring</span> <span m='329297'>demands</span> <span m='329620'>of</span>
  <span m='330042'>the</span> <span m='330464'>devices</span> <span m='330886'>in</span>
  <span m='331308'>the</span> <span m='331730'>face</span> <span m='332152'>of</span>
  <span m='332574'>tight</span> <span m='332996'>deadlines.</span> </p><p><span m='333419'>Speaking</span>
  <span m='333732'>of</span> <span m='334045'>having</span> <span m='334359'>enough</span>
  <span m='334672'>CPU</span> <span m='334986'>cycles,</span> <span m='335299'>there</span>
  <span m='335612'>are</span> <span m='335926'>several</span> <span m='336239'>calculations</span>
  <span m='336553'>we</span> <span m='336866'>need</span> <span m='337179'>to</span>
  <span m='337493'>do</span> <span m='337806'>when</span> <span m='338120'>thinking</span>
  <span m='338797'>about</span> <span m='339475'>recurring</span> <span m='340152'>interrupts.</span>
  </p><p><span m='340830'>The</span> <span m='341159'>first</span> <span m='341488'>is</span>
  <span m='341818'>to</span> <span m='342147'>consider</span> <span m='342476'>how</span>
  <span m='342806'>much</span> <span m='343135'>load</span> <span m='343464'>each</span>
  <span m='343794'>periodic</span> <span m='344123'>request</span> <span m='344452'>places</span>
  <span m='344782'>on</span> <span m='345111'>the</span> <span m='345440'>system.</span>
  </p><p><span m='345770'>There's</span> <span m='346192'>one</span> <span m='346615'>keyboard</span>
  <span m='347038'>request</span> <span m='347460'>every</span> <span m='347883'>10</span>
  <span m='348306'>ms</span> <span m='348728'>and</span> <span m='349151'>servicing</span>
  <span m='349574'>each</span> <span m='349996'>request</span> <span m='350419'>takes</span>
  <span m='350842'>800</span> <span m='351264'>us,</span> <span m='351687'>which</span>
  <span m='352110'>consumes</span> <span m='352962'>800us/10ms</span> <span m='353815'>=</span>
  <span m='354668'>8%</span> <span m='355521'>of</span> <span m='356374'>the</span>
  <span m='357227'>CPU.</span> </p><p><span m='358080'>A</span> <span m='358444'>similar</span>
  <span m='358809'>calculation</span> <span m='359174'>shows</span> <span m='359538'>that</span>
  <span m='359903'>servicing</span> <span m='360268'>the</span> <span m='360632'>disk</span>
  <span m='360997'>takes</span> <span m='361362'>25%</span> <span m='361726'>of</span>
  <span m='362091'>the</span> <span m='362456'>CPU</span> <span m='362820'>and</span>
  <span m='363185'>servicing</span> <span m='363550'>the</span> <span m='364084'>printer</span>
  <span m='364618'>takes</span> <span m='365152'>40%</span> <span m='365687'>of</span>
  <span m='366221'>the</span> <span m='366755'>CPU.</span> </p><p><span m='367290'>Collectively</span>
  <span m='367740'>servicing</span> <span m='368191'>all</span> <span m='368642'>the</span>
  <span m='369092'>devices</span> <span m='369543'>takes</span> <span m='369994'>73%</span>
  <span m='370444'>of</span> <span m='370895'>the</span> <span m='371346'>CPU</span>
  <span m='371796'>cycles,</span> <span m='372247'>leaving</span> <span m='372698'>27%</span>
  <span m='373148'>for</span> <span m='373599'>running</span> <span m='374050'>user-mode</span>
  <span m='375145'>programs.</span> </p><p><span m='376240'>Obviously</span> <span
  m='376538'>we'd</span> <span m='376836'>be</span> <span m='377134'>in</span> <span
  m='377432'>trouble</span> <span m='377730'>if</span> <span m='378028'>takes</span>
  <span m='378326'>more</span> <span m='378624'>than</span> <span m='378922'>100%</span>
  <span m='379220'>of</span> <span m='379518'>the</span> <span m='379816'>available</span>
  <span m='380114'>cycles</span> <span m='380412'>to</span> <span m='380710'>service</span>
  <span m='381009'>the</span> <span m='381949'>devices.</span> </p><p><span m='382889'>Another</span>
  <span m='383180'>way</span> <span m='383472'>to</span> <span m='383763'>get</span>
  <span m='384055'>in</span> <span m='384347'>trouble</span> <span m='384638'>is</span>
  <span m='384930'>to</span> <span m='385222'>not</span> <span m='385513'>have</span>
  <span m='385805'>enough</span> <span m='386096'>CPU</span> <span m='386388'>cycles</span>
  <span m='386680'>to</span> <span m='386971'>meet</span> <span m='387263'>each</span>
  <span m='387555'>of</span> <span m='387846'>the</span> <span m='388138'>deadlines.</span>
  </p><p><span m='388430'>We</span> <span m='388780'>need</span> <span m='389130'>500/800</span>
  <span m='389480'>=</span> <span m='389830'>67.5%</span> <span m='390180'>of</span>
  <span m='390530'>the</span> <span m='390880'>cycles</span> <span m='391230'>to</span>
  <span m='391580'>service</span> <span m='391930'>the</span> <span m='392280'>disk</span>
  <span m='392630'>in</span> <span m='392980'>the</span> <span m='393330'>time</span>
  <span m='393680'>between</span> <span m='394030'>the</span> <span m='394380'>disk</span>
  <span m='394730'>request</span> <span m='395080'>and</span> <span m='396046'>disk</span>
  <span m='397012'>deadline.</span> </p><p><span m='397979'>If</span> <span m='398291'>we</span>
  <span m='398604'>assume</span> <span m='398917'>we</span> <span m='399229'>want</span>
  <span m='399542'>to</span> <span m='399855'>finish</span> <span m='400168'>serving</span>
  <span m='400480'>one</span> <span m='400793'>printer</span> <span m='401106'>request</span>
  <span m='401419'>before</span> <span m='401731'>receiving</span> <span m='402044'>the</span>
  <span m='402357'>next,</span> <span m='402670'>the</span> <span m='403214'>effective</span>
  <span m='403758'>printer</span> <span m='404302'>deadline</span> <span m='404846'>is</span>
  <span m='405390'>1000</span> <span m='405934'>us.</span> </p><p><span m='406479'>In</span>
  <span m='406847'>1000</span> <span m='407216'>us</span> <span m='407585'>we</span>
  <span m='407954'>need</span> <span m='408323'>to</span> <span m='408692'>be</span>
  <span m='409061'>able</span> <span m='409430'>to</span> <span m='409798'>service</span>
  <span m='410167'>one</span> <span m='410536'>higher-priority</span> <span m='410905'>disk</span>
  <span m='411274'>request</span> <span m='411643'>(500</span> <span m='412012'>us)</span>
  <span m='412381'>and,</span> <span m='412750'>obviously,</span> <span m='413358'>the</span>
  <span m='413966'>printer</span> <span m='414575'>request</span> <span m='415183'>(400</span>
  <span m='415791'>us).</span> </p><p><span m='416400'>So</span> <span m='416788'>we'll</span>
  <span m='417176'>need</span> <span m='417564'>to</span> <span m='417952'>use</span>
  <span m='418340'>900</span> <span m='418728'>us</span> <span m='419116'>of</span>
  <span m='419504'>the</span> <span m='419892'>CPU</span> <span m='420280'>in</span>
  <span m='420668'>that</span> <span m='421056'>1000</span> <span m='421444'>us</span>
  <span m='421832'>interval.</span> </p><p><span m='422220'>Whew,</span> <span m='422776'>just</span>
  <span m='423332'>barely</span> <span m='423888'>made</span> <span m='424444'>it!</span>
  </p><p><span m='425000'>Suppose</span> <span m='425438'>we</span> <span m='425877'>tried</span>
  <span m='426316'>setting</span> <span m='426755'>the</span> <span m='427194'>keyboard</span>
  <span m='427633'>deadline</span> <span m='428072'>to</span> <span m='428511'>2000</span>
  <span m='428950'>us.</span> </p><p><span m='429389'>In</span> <span m='429739'>that</span>
  <span m='430089'>time</span> <span m='430439'>interval</span> <span m='430789'>we'd</span>
  <span m='431139'>also</span> <span m='431489'>need</span> <span m='431839'>to</span>
  <span m='432189'>service</span> <span m='432539'>1</span> <span m='432889'>disk</span>
  <span m='433239'>request</span> <span m='433589'>and</span> <span m='433939'>2</span>
  <span m='434289'>printer</span> <span m='434639'>requests.</span> </p><p><span m='434990'>So</span>
  <span m='435533'>the</span> <span m='436076'>total</span> <span m='436620'>service</span>
  <span m='437163'>time</span> <span m='437706'>needed</span> <span m='438250'>is</span>
  <span m='438793'>500</span> <span m='439336'>+</span> <span m='439880'>2*400</span>
  <span m='440423'>+</span> <span m='440966'>800</span> <span m='441510'>=</span>
  <span m='442053'>2100</span> <span m='442596'>us.</span> </p><p><span m='443140'>Oops,</span>
  <span m='443549'>that</span> <span m='443958'>exceeds</span> <span m='444368'>the</span>
  <span m='444777'>2000</span> <span m='445186'>us</span> <span m='445596'>window</span>
  <span m='446005'>we</span> <span m='446415'>were</span> <span m='446824'>given,</span>
  <span m='447233'>so</span> <span m='447643'>we</span> <span m='448052'>can't</span>
  <span m='448462'>meet</span> <span m='448871'>the</span> <span m='449280'>2000</span>
  <span m='449690'>us</span> <span m='450099'>deadline</span> <span m='450509'>with</span>
  <span m='451179'>the</span> <span m='451849'>available</span> <span m='452519'>CPU</span>
  <span m='453189'>resources.</span> </p><p><span m='453860'>But</span> <span m='454250'>if</span>
  <span m='454641'>the</span> <span m='455032'>keyboard</span> <span m='455423'>deadline</span>
  <span m='455814'>is</span> <span m='456205'>3000</span> <span m='456595'>us,</span>
  <span m='456986'>let's</span> <span m='457377'>see</span> <span m='457768'>what</span>
  <span m='458159'>happens.</span> </p><p><span m='458550'>In</span> <span m='458905'>a</span>
  <span m='459261'>3000</span> <span m='459617'>us</span> <span m='459973'>interval</span>
  <span m='460329'>we</span> <span m='460685'>need</span> <span m='461041'>to</span>
  <span m='461397'>service</span> <span m='461752'>2</span> <span m='462108'>disk</span>
  <span m='462464'>requests,</span> <span m='462820'>3</span> <span m='463176'>printer</span>
  <span m='463532'>requests,</span> <span m='463888'>and,</span> <span m='464244'>of</span>
  <span m='464600'>course,</span> <span m='465133'>1</span> <span m='465667'>keyboard</span>
  <span m='466201'>request,</span> <span m='466735'>for</span> <span m='467269'>a</span>
  <span m='467803'>total</span> <span m='468337'>service</span> <span m='468871'>time</span>
  <span m='469405'>of</span> <span m='469938'>2*500</span> <span m='470472'>+</span>
  <span m='471006'>3*400</span> <span m='471540'>+</span> <span m='472074'>800</span>
  <span m='472608'>=</span> <span m='473142'>3000</span> <span m='473676'>us.</span>
  </p><p><span m='474210'>Whew!</span> </p><p><span m='475210'>Just</span> <span m='475296'>made</span>
  <span m='475382'>it!</span> </p>
type: course
uid: 66ed3f3a0ae0de34be5a395b50481d2f

---
None