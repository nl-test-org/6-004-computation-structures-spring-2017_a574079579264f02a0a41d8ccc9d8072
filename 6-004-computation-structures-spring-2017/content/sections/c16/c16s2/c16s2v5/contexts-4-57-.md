---
about_this_resource_text: ''
course_id: 6-004-computation-structures-spring-2017
embedded_media:
- id: Video-YouTube-Stream
  media_location: Z7pKkCDmHh0
  parent_uid: dc07ed32806c5a4230684c40588f10c8
  title: Video-YouTube-Stream
  type: Video
  uid: affa82c2e8cf191d5e2766e1b2d72ef1
- id: 3Play-3Play YouTube id-Stream
  media_location: Z7pKkCDmHh0
  parent_uid: dc07ed32806c5a4230684c40588f10c8
  title: 3Play-3Play YouTube id
  type: 3Play
  uid: 27991b5313ba86b2e5ed3f2ed9a6de6a
- id: Thumbnail-YouTube-JPG_1
  media_location: https://img.youtube.com/vi/Z7pKkCDmHh0/default.jpg
  parent_uid: dc07ed32806c5a4230684c40588f10c8
  title: Thumbnail-YouTube-JPG
  type: Thumbnail
  uid: aec40d91a61c2e5703d7a60f56df121d
- id: Z7pKkCDmHh0.srt
  parent_uid: dc07ed32806c5a4230684c40588f10c8
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-004-computation-structures-spring-2017/c16/c16s2/c16s2v5/contexts-4-57-/Z7pKkCDmHh0.srt
  title: 3play caption file
  type: null
  uid: 0a931ca2742abb0b983aec51897df586
- id: Z7pKkCDmHh0.pdf
  parent_uid: dc07ed32806c5a4230684c40588f10c8
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-004-computation-structures-spring-2017/c16/c16s2/c16s2v5/contexts-4-57-/Z7pKkCDmHh0.pdf
  title: 3play pdf file
  type: null
  uid: 003df9648f855d66ca4fbce6169107d0
- id: Caption-3Play YouTube id-SRT
  parent_uid: dc07ed32806c5a4230684c40588f10c8
  title: Caption-3Play YouTube id-SRT-English - US
  type: Caption
  uid: 63958ec094787fb23b825dc1b9767c1e
- id: Transcript-3Play YouTube id-PDF
  parent_uid: dc07ed32806c5a4230684c40588f10c8
  title: Transcript-3Play YouTube id-PDF-English - US
  type: Transcript
  uid: 7462c053cdd24dfc30583caa6ad947ba
- id: Video-InternetArchive-MP4
  media_location: https://archive.org/download/MIT6.004S17/MIT6_004S17_16-02-05_300k.mp4
  parent_uid: dc07ed32806c5a4230684c40588f10c8
  title: Video-Internet Archive-MP4
  type: Video
  uid: 44cdc078b4ec6aad4cd36ff6eb1ebfcc
inline_embed_id: 48839030contexts45746663200
layout: video
order_index: null
parent_uid: ba8e5eedae5852464700a34f67d0e500
related_resources_text: ''
short_url: contexts-4-57-
technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-004-computation-structures-spring-2017/c16/c16s2/c16s2v5/contexts-4-57-
template_type: Embed
title: Contexts
transcript: <p><span m="560">The</span> <span m="978">page</span> <span m="1396">map</span>
  <span m="1814">provides</span> <span m="2232">the</span> <span m="2650">context</span>
  <span m="3068">for</span> <span m="3486">interpreting</span> <span m="3904">virtual</span>
  <span m="4322">addresses,</span> <span m="4740">i.e.,</span> <span m="5158">it</span>
  <span m="5576">provides</span> <span m="5994">the</span> <span m="6412">information</span>
  <span m="6830">needed</span> <span m="7156">to</span> <span m="7483">correctly</span>
  <span m="7810">determine</span> <span m="8136">where</span> <span m="8463">to</span>
  <span m="8790">find</span> <span m="9116">a</span> <span m="9443">virtual</span>
  <span m="9770">address</span> <span m="10096">in</span> <span m="10423">main</span>
  <span m="10750">memory</span> <span m="11076">or</span> <span m="11403">secondary</span>
  <span m="11730">storage.</span></p><p><span m="13530">Several</span> <span m="14009">programs</span>
  <span m="14489">may</span> <span m="14969">be</span> <span m="15449">simultaneously</span>
  <span m="15929">loaded</span> <span m="16409">into</span> <span m="16889">main</span>
  <span m="17369">memory,</span> <span m="17849">each</span> <span m="18329">with</span>
  <span m="18809">its</span> <span m="19289">own</span> <span m="19769">context.</span></p><p><span
  m="20249">Note</span> <span m="20621">that</span> <span m="20994">the</span> <span
  m="21367">separate</span> <span m="21740">contexts</span> <span m="22113">ensure</span>
  <span m="22486">that</span> <span m="22859">the</span> <span m="23232">programs</span>
  <span m="23605">don't</span> <span m="23978">interfere</span> <span m="24351">which</span>
  <span m="24724">each</span> <span m="25097">other.</span></p><p><span m="25470">For</span>
  <span m="25851">example,</span> <span m="26233">the</span> <span m="26615">physical</span>
  <span m="26997">location</span> <span m="27379">for</span> <span m="27761">virtual</span>
  <span m="28143">address</span> <span m="28525">0</span> <span m="28907">in</span>
  <span m="29289">one</span> <span m="29671">program</span> <span m="30053">will</span>
  <span m="30435">be</span> <span m="30817">different</span> <span m="31199">than</span>
  <span m="31703">the</span> <span m="32208">physical</span> <span m="32712">location</span>
  <span m="33217">for</span> <span m="33722">virtual</span> <span m="34226">address</span>
  <span m="34731">0</span> <span m="35236">in</span> <span m="35740">another</span>
  <span m="36245">program.</span></p><p><span m="36750">Each</span> <span m="37262">program</span>
  <span m="37774">operates</span> <span m="38286">independently</span> <span m="38798">in</span>
  <span m="39310">its</span> <span m="39822">own</span> <span m="40334">virtual</span>
  <span m="40846">address</span> <span m="41358">space.</span></p><p><span m="41870">It's</span>
  <span m="42192">the</span> <span m="42514">context</span> <span m="42837">provided</span>
  <span m="43159">by</span> <span m="43481">the</span> <span m="43804">page</span>
  <span m="44126">map</span> <span m="44448">that</span> <span m="44771">allows</span>
  <span m="45093">them</span> <span m="45415">to</span> <span m="45738">coexist</span>
  <span m="46060">and</span> <span m="46382">share</span> <span m="46705">a</span>
  <span m="47027">common</span> <span m="47350">physical</span> <span m="48455">memory.</span></p><p><span
  m="49560">So</span> <span m="49994">we</span> <span m="50428">need</span> <span
  m="50863">to</span> <span m="51297">switch</span> <span m="51732">contexts</span>
  <span m="52166">when</span> <span m="52601">switching</span> <span m="53035">programs.</span></p><p><span
  m="53470">This</span> <span m="53803">is</span> <span m="54137">accomplished</span>
  <span m="54471">by</span> <span m="54805">reloading</span> <span m="55138">the</span>
  <span m="55472">page</span> <span m="55806">map.</span></p><p><span m="56140">In</span>
  <span m="56599">a</span> <span m="57058">timesharing</span> <span m="57518">system,</span>
  <span m="57977">the</span> <span m="58436">CPU</span> <span m="58896">will</span>
  <span m="59355">periodically</span> <span m="59814">switch</span> <span m="60274">from</span>
  <span m="60733">running</span> <span m="61192">one</span> <span m="61652">program</span>
  <span m="62111">to</span> <span m="62570">another,</span> <span m="63030">giving</span>
  <span m="63447">the</span> <span m="63864">illusion</span> <span m="64281">that</span>
  <span m="64698">multiple</span> <span m="65115">programs</span> <span m="65532">are</span>
  <span m="65949">each</span> <span m="66366">running</span> <span m="66783">on</span>
  <span m="67200">their</span> <span m="67617">own</span> <span m="68034">virtual</span>
  <span m="68451">machine.</span></p><p><span m="68869">This</span> <span m="69286">is</span>
  <span m="69703">accomplished</span> <span m="70121">by</span> <span m="70538">switching</span>
  <span m="70956">contexts</span> <span m="71373">when</span> <span m="71790">switching</span>
  <span m="72208">the</span> <span m="72625">CPU</span> <span m="73043">state</span>
  <span m="73460">to</span> <span m="73877">the</span> <span m="74295">next</span>
  <span m="74712">program.</span></p><p><span m="75130">There's</span> <span m="75492">a</span>
  <span m="75854">privileged</span> <span m="76216">set</span> <span m="76578">of</span>
  <span m="76940">code</span> <span m="77302">called</span> <span m="77664">the</span>
  <span m="78026">operating</span> <span m="78388">system</span> <span m="78750">(OS)</span>
  <span m="79112">that</span> <span m="79474">manages</span> <span m="79836">the</span>
  <span m="80198">sharing</span> <span m="80560">of</span> <span m="80929">one</span>
  <span m="81298">physical</span> <span m="81668">processor</span> <span m="82037">and</span>
  <span m="82406">main</span> <span m="82776">memory</span> <span m="83145">amongst</span>
  <span m="83514">many</span> <span m="83884">programs,</span> <span m="84253">each</span>
  <span m="84622">with</span> <span m="84992">its</span> <span m="85361">own</span>
  <span m="85730">CPU</span> <span m="86100">state</span> <span m="86736">and</span>
  <span m="87372">virtual</span> <span m="88008">address</span> <span m="88644">space.</span></p><p><span
  m="89280">The</span> <span m="89709">OS</span> <span m="90139">is</span> <span m="90569">effectively</span>
  <span m="90999">creating</span> <span m="91429">many</span> <span m="91859">virtual</span>
  <span m="92289">machines</span> <span m="92719">and</span> <span m="93149">choreographing</span>
  <span m="93579">their</span> <span m="94009">execution</span> <span m="94439">using</span>
  <span m="95041">a</span> <span m="95644">single</span> <span m="96246">set</span>
  <span m="96849">of</span> <span m="97451">shared</span> <span m="98054">physical</span>
  <span m="98656">resources.</span></p><p><span m="99259">The</span> <span m="99669">OS</span>
  <span m="100080">runs</span> <span m="100491">in</span> <span m="100902">a</span>
  <span m="101313">special</span> <span m="101724">OS</span> <span m="102134">context,</span>
  <span m="102545">which</span> <span m="102956">we</span> <span m="103367">call</span>
  <span m="103778">the</span> <span m="104189">kernel.</span></p><p><span m="104600">The</span>
  <span m="105143">OS</span> <span m="105686">contains</span> <span m="106229">the</span>
  <span m="106772">necessary</span> <span m="107315">exception</span> <span m="107858">handlers</span>
  <span m="108401">and</span> <span m="108944">timesharing</span> <span m="109487">support.</span></p><p><span
  m="110030">Since</span> <span m="110353">it</span> <span m="110677">has</span> <span
  m="111001">to</span> <span m="111325">manage</span> <span m="111649">physical</span>
  <span m="111973">memory,</span> <span m="112297">it's</span> <span m="112621">allowed</span>
  <span m="112945">to</span> <span m="113269">access</span> <span m="113593">any</span>
  <span m="113917">physical</span> <span m="114241">location</span> <span m="114565">as</span>
  <span m="114889">it</span> <span m="115469">deals</span> <span m="116049">with</span>
  <span m="116629">page</span> <span m="117209">faults,</span> <span m="117789">etc.</span></p><p><span
  m="118369">Exceptions</span> <span m="118674">in</span> <span m="118979">running</span>
  <span m="119285">programs</span> <span m="119590">cause</span> <span m="119896">the</span>
  <span m="120201">hardware</span> <span m="120506">to</span> <span m="120812">switch</span>
  <span m="121117">to</span> <span m="121423">the</span> <span m="121728">kernel</span>
  <span m="122033">context,</span> <span m="122339">which</span> <span m="122644">we</span>
  <span m="122950">call</span> <span m="123689">entering</span> <span m="124429">&quot;kernel</span>
  <span m="125169">mode&quot;.</span></p><p><span m="125909">After</span> <span m="126277">the</span>
  <span m="126646">exception</span> <span m="127014">handling</span> <span m="127383">is</span>
  <span m="127751">complete,</span> <span m="128120">execution</span> <span m="128488">of</span>
  <span m="128857">the</span> <span m="129225">program</span> <span m="129594">resumes</span>
  <span m="129962">in</span> <span m="130331">what</span> <span m="130699">we</span>
  <span m="131068">call</span> <span m="132042">&quot;user</span> <span m="133016">mode&quot;.</span></p><p><span
  m="133990">Since</span> <span m="134281">the</span> <span m="134573">OS</span> <span
  m="134865">runs</span> <span m="135157">in</span> <span m="135448">kernel</span>
  <span m="135740">mode</span> <span m="136032">it</span> <span m="136324">has</span>
  <span m="136615">privileged</span> <span m="136907">access</span> <span m="137199">to</span>
  <span m="137491">many</span> <span m="137782">hardware</span> <span m="138074">registers</span>
  <span m="138366">that</span> <span m="138658">are</span> <span m="138950">inaccessible</span>
  <span m="139562">in</span> <span m="140175">user</span> <span m="140787">mode.</span></p><p><span
  m="141400">These</span> <span m="141880">include</span> <span m="142360">the</span>
  <span m="142840">MMU</span> <span m="143320">state,</span> <span m="143800">I/O</span>
  <span m="144280">devices,</span> <span m="144760">and</span> <span m="145240">so</span>
  <span m="145720">on.</span></p><p><span m="146200">User-mode</span> <span m="146493">programs</span>
  <span m="146786">that</span> <span m="147080">need</span> <span m="147373">to</span>
  <span m="147667">access,</span> <span m="147960">say,</span> <span m="148254">the</span>
  <span m="148547">disk,</span> <span m="148841">need</span> <span m="149134">to</span>
  <span m="149428">make</span> <span m="149721">a</span> <span m="150015">request</span>
  <span m="150308">to</span> <span m="150602">the</span> <span m="150895">OS</span>
  <span m="151189">kernel</span> <span m="151512">to</span> <span m="151836">perform</span>
  <span m="152160">the</span> <span m="152484">operation,</span> <span m="152808">giving</span>
  <span m="153131">the</span> <span m="153455">OS</span> <span m="153779">the</span>
  <span m="154103">chance</span> <span m="154427">to</span> <span m="154750">vet</span>
  <span m="155074">the</span> <span m="155398">request</span> <span m="155722">for</span>
  <span m="156046">appropriate</span> <span m="156370">permissions,</span> <span m="157615">etc.</span></p><p><span
  m="158860">We'll</span> <span m="159305">see</span> <span m="159750">how</span>
  <span m="160196">all</span> <span m="160641">of</span> <span m="161087">this</span>
  <span m="161532">works</span> <span m="161978">in</span> <span m="162423">an</span>
  <span m="162869">upcoming</span> <span m="163314">lecture.</span></p><p><span m="163760">User-mode</span>
  <span m="164162">programs</span> <span m="164565">(aka</span> <span m="164968">applications)</span>
  <span m="165371">are</span> <span m="165774">written</span> <span m="166177">as</span>
  <span m="166580">if</span> <span m="166982">they</span> <span m="167385">have</span>
  <span m="167788">access</span> <span m="168191">to</span> <span m="168594">the</span>
  <span m="168997">entire</span> <span m="169400">virtual</span> <span m="170309">address</span>
  <span m="171219">space.</span></p><p><span m="172129">They</span> <span m="172406">often</span>
  <span m="172683">obey</span> <span m="172961">the</span> <span m="173238">same</span>
  <span m="173516">conventions</span> <span m="173793">such</span> <span m="174071">as</span>
  <span m="174348">the</span> <span m="174626">address</span> <span m="174903">of</span>
  <span m="175181">the</span> <span m="175458">first</span> <span m="175736">instruction</span>
  <span m="176013">in</span> <span m="176291">the</span> <span m="176777">program,</span>
  <span m="177264">the</span> <span m="177751">initial</span> <span m="178238">value</span>
  <span m="178725">for</span> <span m="179211">the</span> <span m="179698">stack</span>
  <span m="180185">pointer,</span> <span m="180672">etc.</span></p><p><span m="181159">Since</span>
  <span m="181576">all</span> <span m="181994">these</span> <span m="182412">virtual</span>
  <span m="182830">addresses</span> <span m="183247">are</span> <span m="183665">interpreted</span>
  <span m="184083">using</span> <span m="184501">the</span> <span m="184918">current</span>
  <span m="185336">context,</span> <span m="185754">by</span> <span m="186172">controlling</span>
  <span m="186590">the</span> <span m="187235">contexts</span> <span m="187880">the</span>
  <span m="188526">OS</span> <span m="189171">can</span> <span m="189816">ensure</span>
  <span m="190462">that</span> <span m="191107">the</span> <span m="191753">programs</span>
  <span m="192398">can</span> <span m="193043">coexist</span> <span m="193689">without</span>
  <span m="194334">conflict.</span></p><p><span m="194980">The</span> <span m="195266">diagram</span>
  <span m="195553">on</span> <span m="195840">the</span> <span m="196126">right</span>
  <span m="196413">shows</span> <span m="196700">a</span> <span m="196986">standard</span>
  <span m="197273">plan</span> <span m="197560">for</span> <span m="197846">organizing</span>
  <span m="198133">the</span> <span m="198420">virtual</span> <span m="198706">address</span>
  <span m="198993">space</span> <span m="199280">of</span> <span m="199833">an</span>
  <span m="200386">application.</span></p><p><span m="200939">Typically</span> <span
  m="201372">the</span> <span m="201806">first</span> <span m="202239">virtual</span>
  <span m="202673">page</span> <span m="203107">is</span> <span m="203540">made</span>
  <span m="203974">inaccessible,</span> <span m="204408">which</span> <span m="204841">helps</span>
  <span m="205275">catch</span> <span m="205709">errors</span> <span m="206142">involving</span>
  <span m="206576">references</span> <span m="207010">to</span> <span m="207982">uninitialized</span>
  <span m="208954">(i.e.,</span> <span m="209926">zero-valued)</span> <span m="210898">pointers.</span></p><p><span
  m="211870">Then</span> <span m="212196">come</span> <span m="212523">some</span>
  <span m="212850">number</span> <span m="213176">of</span> <span m="213503">read-only</span>
  <span m="213830">pages</span> <span m="214156">that</span> <span m="214483">hold</span>
  <span m="214810">the</span> <span m="215136">application's</span> <span m="215463">code</span>
  <span m="215790">and</span> <span m="216116">perhaps</span> <span m="216443">the</span>
  <span m="216770">code</span> <span m="217309">from</span> <span m="217849">any</span>
  <span m="218389">shared</span> <span m="218929">libraries</span> <span m="219469">it</span>
  <span m="220009">uses.</span></p><p><span m="220549">Marking</span> <span m="220959">code</span>
  <span m="221370">pages</span> <span m="221781">as</span> <span m="222192">read-only</span>
  <span m="222603">avoids</span> <span m="223014">hard-to-find</span> <span m="223424">bugs</span>
  <span m="223835">where</span> <span m="224246">errant</span> <span m="224657">data</span>
  <span m="225068">accesses</span> <span m="225479">inadvertently</span> <span m="225890">change</span>
  <span m="226739">the</span> <span m="227589">program!</span></p><p><span m="228439">Then</span>
  <span m="228962">there</span> <span m="229485">are</span> <span m="230009">read-write</span>
  <span m="230532">pages</span> <span m="231055">holding</span> <span m="231579">the</span>
  <span m="232102">application's</span> <span m="232625">statically</span> <span m="233149">allocated</span>
  <span m="233672">data</span> <span m="234195">structures.</span></p><p><span m="234719">The</span>
  <span m="235029">rest</span> <span m="235339">of</span> <span m="235649">the</span>
  <span m="235959">virtual</span> <span m="236269">address</span> <span m="236579">space</span>
  <span m="236889">is</span> <span m="237199">divided</span> <span m="237509">between</span>
  <span m="237819">two</span> <span m="238129">data</span> <span m="238439">regions</span>
  <span m="238749">that</span> <span m="239059">can</span> <span m="239369">grow</span>
  <span m="239679">over</span> <span m="239989">time.</span></p><p><span m="241590">The</span>
  <span m="242052">first</span> <span m="242515">is</span> <span m="242977">the</span>
  <span m="243440">application's</span> <span m="243902">stack,</span> <span m="244365">used</span>
  <span m="244827">to</span> <span m="245290">hold</span> <span m="245752">procedure</span>
  <span m="246215">activation</span> <span m="246677">records.</span></p><p><span
  m="247140">Here</span> <span m="247381">we</span> <span m="247622">show</span> <span
  m="247863">it</span> <span m="248104">located</span> <span m="248345">at</span>
  <span m="248586">the</span> <span m="248827">lower</span> <span m="249068">end</span>
  <span m="249310">of</span> <span m="249551">the</span> <span m="249792">virtual</span>
  <span m="250033">address</span> <span m="250274">space</span> <span m="250515">since</span>
  <span m="250756">our</span> <span m="250997">convention</span> <span m="251239">is</span>
  <span m="251816">that</span> <span m="252394">the</span> <span m="252971">stack</span>
  <span m="253549">grows</span> <span m="254127">towards</span> <span m="254704">higher</span>
  <span m="255282">addresses.</span></p><p><span m="255860">The</span> <span m="256245">other</span>
  <span m="256630">growable</span> <span m="257015">region</span> <span m="257400">is</span>
  <span m="257785">the</span> <span m="258170">heap,</span> <span m="258555">used</span>
  <span m="258940">when</span> <span m="259325">dynamically</span> <span m="259710">allocating</span>
  <span m="260095">storage</span> <span m="260480">for</span> <span m="260865">long-lived</span>
  <span m="261250">data</span> <span m="261959">structures.</span></p><p><span m="262669">&quot;Dynamically&quot;</span>
  <span m="263038">means</span> <span m="263407">that</span> <span m="263776">the</span>
  <span m="264146">allocation</span> <span m="264515">and</span> <span m="264884">deallocation</span>
  <span m="265254">of</span> <span m="265623">objects</span> <span m="265992">is</span>
  <span m="266362">done</span> <span m="266731">by</span> <span m="267100">explicit</span>
  <span m="267470">procedure</span> <span m="267922">calls</span> <span m="268375">while</span>
  <span m="268828">the</span> <span m="269280">application</span> <span m="269733">is</span>
  <span m="270186">running.</span></p><p><span m="270639">In</span> <span m="270987">other</span>
  <span m="271336">words,</span> <span m="271685">we</span> <span m="272033">don't</span>
  <span m="272382">know</span> <span m="272731">which</span> <span m="273080">objects</span>
  <span m="273428">will</span> <span m="273777">be</span> <span m="274126">created</span>
  <span m="274475">until</span> <span m="274823">the</span> <span m="275172">program</span>
  <span m="275521">actually</span> <span m="275870">executes.</span></p><p><span m="276870">As</span>
  <span m="277410">shown</span> <span m="277951">here,</span> <span m="278492">as</span>
  <span m="279033">the</span> <span m="279574">heap</span> <span m="280115">expands</span>
  <span m="280655">it</span> <span m="281196">grows</span> <span m="281737">towards</span>
  <span m="282278">lower</span> <span m="282819">addresses.</span></p><p><span m="283360">The</span>
  <span m="283691">page</span> <span m="284022">fault</span> <span m="284354">handler</span>
  <span m="284685">knows</span> <span m="285017">to</span> <span m="285348">allocate</span>
  <span m="285680">new</span> <span m="286011">pages</span> <span m="286343">when</span>
  <span m="286674">these</span> <span m="287006">regions</span> <span m="287337">grow.</span></p><p><span
  m="287669">Of</span> <span m="287998">course,</span> <span m="288328">if</span>
  <span m="288657">they</span> <span m="288987">ever</span> <span m="289316">meet</span>
  <span m="289646">somewhere</span> <span m="289975">in</span> <span m="290305">the</span>
  <span m="290634">middle</span> <span m="290964">and</span> <span m="291293">more</span>
  <span m="291623">space</span> <span m="291952">is</span> <span m="292282">needed,</span>
  <span m="292611">the</span> <span m="292941">application</span> <span m="293271">is</span>
  <span m="293525">out</span> <span m="293779">of</span> <span m="294034">luck</span>
  <span m="294288">-</span> <span m="294543">it's</span> <span m="294797">run</span>
  <span m="295052">out</span> <span m="295306">of</span> <span m="295561">virtual</span>
  <span m="295815">memory!</span></p>
type: course
uid: dc07ed32806c5a4230684c40588f10c8

---
None